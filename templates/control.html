<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edu Dashboard</title>
    <link rel="stylesheet" href="static/css/con_student.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/percent.js"></script>

    <div class="container">
      <div class="sidebar">
        <div class="logo">
          <img src="images/logo.png" alt="" />
        </div>
        <div class="selectorsCombined">
          <div class="selectors default activeBar" id="dashboardButton">
            <i class="fa-solid fa-table-cells-large dashboardIcon"></i>
            <div>ููุญุฉ ุงูุชุญูู</div>
          </div>
          <div class="selectors default" id="overviewButton">
            <i class="fa-solid fa-gauge"></i>
            <div>ูุธุฑุฉ ุนุงูุฉ</div>
          </div>
          <div class="selectors default" id="studentButton">
            <i class="fa-solid fa-graduation-cap"></i>
            <div>ุงูุทูุงุจ</div>
          </div>
          <div class="selectors default" id="teacherButton">
            <i class="fa-solid fa-chalkboard-user"></i>
            <div>ุงูุฃุณุงุชุฐุฉ</div>
          </div>
          <div class="selectors default">
            <i class="fa-solid fa-note-sticky"></i>
            <div>ุงูุงูุชุญุงูุงุช</div>
          </div>
          <div class="selectors default" id="resultsButton">
            <i class="fa-solid fa-chart-column"></i>
            <div>ูุชุงุฆุฌ ุงูุทูุงุจ</div>
          </div>
          <div class="selectors default" id="announcementsButton">
            <i class="fa-solid fa-bullhorn"></i>
            <div>ุงูุฅุนูุงูุงุช</div>
          </div>
          <div
            class="selectors default"
            id="announcementsButton1111111111111111111111111"
          >
            <i class="fa-solid fa-bullhorn"></i>
            <div>ุงููุฏูุงุช</div>
          </div>
        </div>
      </div>

      <div class="body">
        <!-- ๐ข ูุณู ููุญุฉ ุงูุชุญูู -->
        <div id="dashboardSection">
          <div class="topBar">
            <h2 class="h2">ููุญุฉ ุงูุชุญูู</h2>
            <div class="right-section">
              <input class="searchBar" type="text" placeholder="ุจุญุซ" />
              <button class="searchButton">
                <img class="searchIcon" src="images/search.png" alt="" />
              </button>
            </div>
          </div>

          <div class="cardsContainer">
            <div class="cards studentCard">
              <div class="hexagon">
                <div class="Icon">
                  <i class="fa-solid fa-graduation-cap"></i>
                </div>
              </div>
              <p class="textIcon">ุฅุฌูุงูู ุงูุทูุงุจ</p>
              <p class="number">1220</p>
            </div>
            <div class="cards teacherCard">
              <div class="Icon">
                <i class="fa-solid fa-chalkboard-user"></i>
              </div>
              <p class="textIcon">ุฅุฌูุงูู ุงูุฃุณุงุชุฐุฉ</p>
              <p class="number">120</p>
            </div>
            <div class="cards courseCard">
              <div class="Icon">
                <i class="fa-solid fa-book-open"></i>
              </div>
              <p class="textIcon">ุฅุฌูุงูู ุงูููุฑุฑุงุช</p>
              <p class="number">15</p>
            </div>
            <div class="cards examCard">
              <div class="Icon">
                <i class="fa-solid fa-note-sticky"></i>
              </div>
              <p class="textIcon">ุฅุฌูุงูู ุงูุงูุชุญุงูุงุช</p>
              <p class="number">6</p>
            </div>
          </div>
        </div>

        <div
          class="container py-5"
          id="announcements-section"
          style="display: none"
        >
          <h2 class="section-title">ูุงุฆูุฉ ุงูุฅุนูุงูุงุช</h2>

          <!-- ุดุฑูุท ุงูุชุญููู -->
          <div id="loading-bar" class="loading-bar" style="display: none"></div>

          <div id="announcements-container">
            {% if announcements %} {% for announcement in announcements %}
            <div class="announcement">
              <h4>{{ announcement["type"] }}</h4>
              <p>{{ announcement["content"] }}</p>

              <p class="teacher-info">
                <strong>ุงูุฃุณุชุงุฐ:</strong> {{ announcement.teacher_name if
                announcement.teacher_name else 'ุบูุฑ ูุชููุฑ' }}
              </p>

              <p class="text-muted">
                ููุดุฑ ูู: {{ announcement.get("timestamp", "ุบูุฑ ูุชููุฑ") }}
              </p>
            </div>
            {% endfor %} {% else %}
            <p class="text-muted">ูุง ุชูุฌุฏ ุฅุนูุงูุงุช ูุชุงุญุฉ ุญุงูููุง.</p>
            {% endif %}
          </div>
        </div>

        <!-- ๐ก ูุณู ุงูุฅุนูุงูุงุช (ูุจุฏุฃ ูุฎูู) -->

        <div id="overviewSection" class="overview-section hidden">
          <div class="overview-card">
            <h3 class="overview-title">๐ ููุฎุต ุงูุฃุฏุงุก ุงูุนุงู</h3>
            <div class="overview-stats">
              <div class="stat-item">
                <span class="stat-label">ูุณุจุฉ ุงููุฌุงุญ</span>
                <span class="stat-value">85%</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">ุนุฏุฏ ุงูุทูุงุจ ุงููุงุฌุญูู</span>
                <span class="stat-value">1037</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">ุนุฏุฏ ุงูุทูุงุจ ุงูุฑุงุณุจูู</span>
                <span class="stat-value">183</span>
              </div>
            </div>
            <div id="smallChart" class="small-chart"></div>
          </div>
        </div>
        <div id="studentSection" class="section hidden">
          <h2>Student Directory <span id="student-count"></span></h2>
          <input
            type="text"
            class="search-input"
            id="search-box-students"
            placeholder="Search students..."
          />
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Student</th>
                  <th>Department</th>
                  <th>Major</th>
                  <th>Status</th>
                  <th>Enrollment Date</th>
                  <th>Location</th>
                </tr>
              </thead>
              <tbody id="studentTableBody"></tbody>
            </table>
          </div>
        </div>

        <div id="teacherSection" class="teacher-section hidden">
          <!-- ูุฐุง ูู ุงูุฌุฒุก ุงูุฐู ุณูุชู ุฅุธูุงุฑู ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ ุงูุฃุณุงุชุฐุฉ -->
          <h2>Employee Directory <span id="total-count"></span></h2>
          <input
            type="text"
            class="search-input"
            id="search-box"
            placeholder="Search employees..."
          />
          <table>
            <thead>
              <tr>
                <th>ุงุณู</th>
                <th>ุงูุชุฎุตุต</th>
                <th>ุงููุตูู</th>
                <th>Date Of Hire</th>
                <th>Location</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="employee-body"></tbody>
          </table>
          <div class="pagination" id="pagination"></div>
        </div>

        <div id="resultsSection" class="results-section hidden">
          <h2>ุฅุฏุฎุงู ุจูุงูุงุช ุงูุทุงูุจ</h2>
          <form id="dataForm">
            <div class="input-box">
              <input
                type="text"
                name="id_card"
                id="id_card"
                placeholder="CNE (ูุซุงู: ZT2261)"
                required
              />
            </div>
            <div class="input-box">
              <input
                type="text"
                name="major"
                id="major"
                placeholder="ูุณุงุฑ (ูุซุงู: A123456789)"
                required
              />
            </div>
            <button type="submit" class="btn">ุชุฃููุฏ</button>
          </form>

          <p class="error-message hidden" id="error-message">
            โ ุงููุนูููุงุช ุบูุฑ ุตุญูุญุฉ
          </p>

          <div id="studentTable" class="hidden">
            <h2>ูุชุงุฆุฌ ุงูุทุงูุจ</h2>
            <div id="studentInfo" class="student-info">
              <!-- ุณูุชู ุนุฑุถ ุงุณู ุงูุทุงูุจ ูุงูุจุฑูุฏ ููุง -->
            </div>
            <table>
              <thead>
                <tr>
                  <th>ุฑูู ุงูุทุงูุจ</th>
                  <th>ุงููุณุชูู</th>
                  <th>ุงููุงุฏุฉ</th>
                  <th>ุงููุนุฏู</th>
                  <th>ุงูููุงุญุธุงุช</th>
                </tr>
              </thead>
              <tbody id="tableBody">
                <!-- ุงูุตููู ุณุชุถุงู ููุง -->
              </tbody>
            </table>
          </div>
        </div>

        <div class="secondRow">
          <div class="statistics">
            <p>ุฅุญุตุงุฆูุงุช</p>
            <div id="chartdiv1"></div>
          </div>
          <div class="studentRatio">
            <p>ูุณุจุฉ ุงูุทูุงุจ</p>
            <div id="chartdiv2"></div>
          </div>
        </div>
        <div class="database">
          <div class="databaseHeader">
            <p>ุฃุจุฑุฒ ูู ุฎูุฏ ุจุตูุชู</p>
            <div class="tabs">
              <button id="studentTab" class="default active">ุงูุฏูุชูุฑ</button>
              <div class="line"></div>
            </div>
          </div>

          <!-- ุฌุฏูู ุงูุทูุงุจ -->
          <table id="studentTable1" class="table">
            <thead>
              <tr>
                <th>ุงุณู ุงูุดุฎุตู</th>
                <th>ุงููุชูุฌุฉ</th>
                <th>ุงููุชุฑุฉ</th>
                <th>ุงูุชูุฏูุฑ</th>
                <th>ุฃูู ุฅูุฌุงุฒุงุช</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>ุงูุทุงูุจ 1</td>
                <td>80/100</td>
                <td>12/10/22 - 10:00 ู</td>
                <td>ููุชุงุฒ</td>
                <td class="passDesign">ูุงุฌุญ</td>
              </tr>
              <tr>
                <td>ุงูุทุงูุจ 2</td>
                <td>70/100</td>
                <td>12/08/22 - 09:00 ู</td>
                <td>ูุชูุณุท</td>
                <td class="passDesign">ูุงุฌุญ</td>
              </tr>
              <tr>
                <td>ุงูุทุงูุจ 3</td>
                <td>30/100</td>
                <td>12/10/22 - 12:45 ู</td>
                <td>ุถุนูู</td>
                <td class="failDesign">ุฑุงุณุจ</td>
              </tr>
              <tr>
                <td>ุงูุทุงูุจ 4</td>
                <td>80/100</td>
                <td>23/10/22 - 10:00 ู</td>
                <td>ููุชุงุฒ</td>
                <td class="passDesign">ูุงุฌุญ</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="rightBar">
        <div class="rightBarHeader">
          <p>ููุญุฉ ุงูุฅุนูุงูุงุช</p>
        </div>
        <div id="notificationWindow" class="notificationWindow">
          <!-- ูุญุชูู ุงูุฅุนูุงูุงุช ููุง -->
        </div>
      </div>

      <button class="notifications" onclick="toggleRightBar()">
        <div><i class="fa-solid fa-bell"></i></div>
      </button>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const dataForm = document.getElementById("dataForm");
        const idCardInput = document.getElementById("id_card");
        const majorInput = document.getElementById("major");
        const errorMessage = document.getElementById("error-message");
        const studentTable = document.getElementById("studentTable");
        const tableBody = document.getElementById("tableBody");
        const studentInfo = document.getElementById("studentInfo");

        const submitButton = document.querySelector("#dataForm button");
        submitButton.addEventListener("click", async function (e) {
          e.preventDefault();
          e.stopPropagation();

          const id_card = idCardInput.value.trim();
          const major = majorInput.value.trim();

          // ุณุฌู ุงูุจูุงูุงุช ููุชุฃูุฏ ูู ุฅุฑุณุงููุง ุจุดูู ุตุญูุญ
          console.log("ID Card:", id_card);
          console.log("Major:", major);

          if (!id_card || !major) {
            errorMessage.textContent = "โ ุงูุฑุฌุงุก ููุก ุฌููุน ุงูุญููู.";
            errorMessage.classList.remove("hidden");
            studentTable.classList.add("hidden");
            return;
          }

          try {
            console.log("Sending request to server...");
            const response = await fetch("/Student_space", {
              method: "POST",
              headers: {
                "Content-Type": "application/json", // ุชุญุฏูุฏ ููุน ุงููุญุชูู ูู JSON
              },
              body: JSON.stringify({ id_card, major }), // ุฅุฑุณุงู ุงูุจูุงูุงุช ุจุชูุณูู JSON
            });

            const data = await response.json();
            console.log("Response data:", data); // ุณุฌู ุงูุงุณุชุฌุงุจุฉ ููุญุต ุงููุชูุฌุฉ

            tableBody.innerHTML = ""; // ูุจุฏุฃ ุจุชูุฑูุบ ุงูุฌุฏูู
            studentInfo.innerHTML = ""; // ูุจุฏุฃ ุจุชูุฑูุบ ูุนูููุงุช ุงูุทุงูุจ

            if (data.success && data.students.length > 0) {
              errorMessage.classList.add("hidden");
              studentTable.classList.remove("hidden");

              // ุฅุถุงูุฉ ูุนูููุงุช ุงูุทุงูุจ
              const student = data.students[0]; // ุงุนุชุจุงุฑ ุฃูู ุทุงูุจ ููุท
              studentInfo.innerHTML = `
                  <p><strong> Name:</strong> ${student.first_name} ${student.last_name}</p>
                  <p><strong>CNE:</strong> ${student.id_card}</p>
                `;

              // ุฅุถุงูุฉ ุจูุงูุงุช ุงูุทูุงุจ ูู ุงูุฌุฏูู
              data.students.forEach((student) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                      <td>${student.student_number}</td>
                      <td>${student.level}</td>
                      <td>${student.subject}</td>
                      <td>${student.average}</td>
                      <td>${student.notes}</td>
                    `;
                tableBody.appendChild(row);
              });

              // ุชุฃุซูุฑ ุจุณูุท
              studentTable.style.opacity = 0;
              setTimeout(() => {
                studentTable.style.transition = "opacity 0.5s ease";
                studentTable.style.opacity = 1;
              }, 50);
            } else {
              studentTable.classList.add("hidden");
              errorMessage.textContent = "โ ูุง ุชูุฌุฏ ูุชุงุฆุฌ ูุทุงุจูุฉ.";
              errorMessage.classList.remove("hidden");
            }
          } catch (error) {
            console.error("Error:", error);
            errorMessage.textContent = "โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุงุชุตุงู ุจุงูุฎุงุฏู.";
            errorMessage.classList.remove("hidden");
            studentTable.classList.add("hidden");
          }
        });
      });
    </script>
  </body>

  <script src="static/js/scr_student.js"></script>
  <script src="static/js/con_student.js"></script>
</html>
