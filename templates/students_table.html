<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø¹Ø±Ø¶ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</title>
    <style>
      /* ØªÙ†Ø³ÙŠÙ‚ Ø¹Ø§Ù… Ù„Ù„Ø¬Ø³Ù… */
      body {
        font-family: "Arial", sans-serif;
        background-color: #f0f8ff;
        margin: 0;
        padding: 0;
        direction: rtl;
      }

      /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
      .container {
        max-width: 900px;
        margin: 50px auto;
        background-color: #ffffff;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
      h1 {
        text-align: center;
        color: #ff2770;
        margin-bottom: 20px;
        font-size: 1.8em;
      }

      /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 30px;
      }

      table th,
      table td {
        padding: 10px;
        text-align: center;
        border: 1px solid #ddd;
      }

      table th {
        background-color: #ff2770;
        color: white;
      }

      table tr:nth-child(even) {
        background-color: #f2f2f2;
      }

      /* ØªÙ†Ø³ÙŠÙ‚ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ */
      .status-v {
        color: green;
        font-weight: bold;
      }

      .status-nv {
        color: red;
        font-weight: bold;
      }

      .status-absent {
        color: orange;
        font-weight: bold;
      }

      /* ØªØµÙ…ÙŠÙ… Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ */
      .stats-container {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
      }

      .stat-box {
        flex: 1;
        background: linear-gradient(to right, #ff2770, #ff2770);
        color: white;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        font-size: 1.2em;
        font-weight: bold;
        margin: 10px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
      }

      .stat-box.absent {
        background: linear-gradient(to right, #ffa500, #ff8c00);
      }

      .stat-box.success {
        background: linear-gradient(to right, #2196f3, #1e88e5);
      }

      .stat-box.fail {
        background: linear-gradient(to right, #ff5722, #e64a19);
      }

      /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
      .additional-fields {
        margin-top: 20px;
      }

      .additional-fields label {
        font-size: 16px;
        font-weight: bold;
        display: block;
        margin-bottom: 10px;
      }

      .additional-fields input {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        margin-bottom: 10px;
        border-radius: 5px;
        border: 1px solid #ddd;
      }
    </style>
  </head>

  <body data-page-group="group1">
    <div class="container">
      <h1>Ø¹Ø±Ø¶ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h1>

      <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ù„Ø£Ø³ØªØ§Ø° ÙˆØ§Ù„Ù…Ø§Ø¯Ø©) -->
      <div class="stat-box">Ø§Ø³Ù… Ø§Ù„Ø£Ø³ØªØ§Ø°: {{ teacher_name }}</div>

      <div class="stat-box">Ø§Ù„Ù…Ø§Ø¯Ø©: {{ teacher_subject }}</div>
    </div>

    <!-- Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø« -->
    <input
      type="text"
      id="searchInput"
      placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨..."
      style="width: 100%; padding: 10px; font-size: 16px; margin-bottom: 20px"
    />

    <!-- Ø¬Ø¯ÙˆÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
    <!-- Ø¬Ø¯ÙˆÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
    <table>
      <thead>
        <tr>
          <th>ØªØ¹Ø¯ÙŠÙ„</th>
          <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
          <th>Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</th>
          <th>Ø§Ø³Ù… Ø¨Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©</th>
          <th>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ©</th>
          <th>ÙƒÙˆØ¯ Ù…Ø³Ø§Ø±</th>
          <th>Ø§Ù„Ø±Ù‚Ù…</th>
        </tr>
      </thead>
      <tbody>
        {% for student in students %}
        <tr>
          <td>
            <button
              onclick="redirectToEdit(
                    '{{ student.student_number }}',
                    '{{ student.name }}',
                    '{{ student.name_ar }}',
                    '{{ student.id_card }}',
                    '{{ student.code_massar }}',
                    '{{ student.points }}'
                )"
            >
              ØªØ¹Ø¯ÙŠÙ„
            </button>
          </td>
          <td
            class="{% if student.points == 'absent' %}status-absent{% elif student.points is not none and student.points | int >= 10 %}status-v{% else %}status-nv{% endif %}"
          >
            {% if student.points == "absent" %} ØºØ§Ø¦Ø¨ {% elif student.points is
            not none and student.points | int >= 10 %} Ù…Ø³ØªÙˆÙÙ {% else %} Ù…Ø³ØªØ¯Ø±Ùƒ
            {% endif %}
          </td>
          <td>
            {% if student.points == "absent" %} absent {% elif student.points is
            not none %} {{ student.points }} {% else %} ØºÙŠØ± Ù…Ø­Ø¯Ø¯ {% endif %}
          </td>
          <td>{{ student.name_ar }}</td>
          <td>{{ student.name }}</td>
          <td>{{ student.id_card }}</td>
          <td>{{ student.code_massar }}</td>
          <td>{{ student.student_number }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ -->
    <p
      class="no-results-message"
      style="
        display: none;
        text-align: center;
        color: red;
        font-size: 16px;
        margin-top: 20px;
      "
    >
      Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ø¨Ø­Ø«Ùƒ.
    </p>

    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ -->
    <div
      class="stats-container"
      style="display: flex; justify-content: space-around; margin-top: 20px"
    >
      <div class="stat-box">
        Ø§Ù„Ø·Ù„Ø¨Ø© Ø§Ù„Ø­Ø§Ø¶Ø±ÙˆÙ†: {{ students | selectattr("points", "!=", "absent") |
        list | length }}
      </div>
      <div class="stat-box absent">
        Ø§Ù„Ø·Ù„Ø¨Ø© Ø§Ù„ØºØ§Ø¦Ø¨ÙˆÙ†: {{ students | selectattr("points", "==", "absent") |
        list | length }}
      </div>
      <div class="stat-box success">
        Ø§Ù„Ø·Ù„Ø¨Ø© Ø§Ù„Ù…Ø³ØªÙˆÙÙˆÙ†: {{ students | selectattr("points", "!=", "absent") |
        map(attribute="points") | map("int") | select("ge", 10) | list | length
        }}
      </div>
      <div class="stat-box fail">
        Ø§Ù„Ø·Ù„Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ¯Ø±ÙƒÙˆÙ†: {{ students | selectattr("points", "!=", "absent") |
        map(attribute="points") | map("int") | select("lt", 10) | list | length
        }}
      </div>
    </div>

    <!-- Ø²Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯ -->
    <div style="text-align: center; margin-top: 20px">
      <button
        id="confirmButton"
        style="
          background: #ff2770;
          border-radius: 40px;
          width: 10%;
          height: 45px;
          font-size: 16px;
          border: none;
          outline: none;
          cursor: pointer;
        "
      >
        ØªØ£ÙƒÙŠØ¯
      </button>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <div
      id="confirmationModal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
      "
    >
      <div
        style="
          background: white;
          padding: 20px;
          border-radius: 8px;
          text-align: center;
          width: 300px;
        "
      >
        <h2>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h2>
        <p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ</p>
        <button
          id="confirmYes"
          style="
            margin: 10px;
            padding: 10px 20px;
            background-color: green;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
          "
        >
          Ù†Ø¹Ù…
        </button>
        <button
          id="confirmNo"
          style="
            margin: 10px;
            padding: 10px 20px;
            background-color: red;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
          "
        >
          Ù„Ø§
        </button>
      </div>
    </div>

    <script>
      function redirectToEdit(
        number,
        name,
        nameAr,
        id_card,
        code_massar,
        points
      ) {
        const url = `/manual_input?number=${encodeURIComponent(
          number
        )}&name=${encodeURIComponent(name)}&nameAr=${encodeURIComponent(
          nameAr
        )}&id_card=${encodeURIComponent(
          id_card
        )}&code_massar=${encodeURIComponent(
          code_massar
        )}&points=${encodeURIComponent(points)}`;
        window.location.href = url;
      }

      document
        .getElementById("submitBtn")
        .addEventListener("click", function (event) {
          event.preventDefault();

          const studentNumber = document
            .getElementById("student_number")
            .value.trim();
          const points = document.getElementById("points").value.trim();

          if (!studentNumber || !points) {
            alert("âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ùˆ Ø§Ù„Ù†Ù‚Ø§Ø·");
            return;
          }

          fetch("/update_student", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              student_number: studentNumber,
              points: points,
            }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨Ù†Ø¬Ø§Ø­!");
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                loadStudentsData();
              } else {
                alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«: " + data.error);
              }
            })
            .catch((error) =>
              console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error)
            );
        });
    </script>

    <script>
      document
        .getElementById("confirmButton")
        .addEventListener("click", function () {
          document.getElementById("confirmationModal").style.display = "flex";
        });

      document
        .getElementById("confirmYes")
        .addEventListener("click", function () {
          document.getElementById("confirmationModal").style.display = "none";
          alert("ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!");
        });

      document
        .getElementById("confirmNo")
        .addEventListener("click", function () {
          document.getElementById("confirmationModal").style.display = "none";
        });
    </script>
    <script>
      document
        .getElementById("searchInput")
        .addEventListener("keyup", function () {
          var filter = this.value.toLowerCase().trim();
          var rows = document.querySelectorAll("tbody tr");
          var hasVisibleRows = false; // Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØµÙÙˆÙ Ù…Ø±Ø¦ÙŠ

          rows.forEach(function (row) {
            var cells = row.querySelectorAll("td");
            var found = false;

            cells.forEach(function (cell) {
              cell.innerHTML = cell.textContent; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ
              if (
                filter !== "" &&
                cell.textContent.toLowerCase().includes(filter)
              ) {
                cell.innerHTML = cell.textContent.replace(
                  new RegExp(filter, "gi"),
                  (match) => `<span class="highlight">${match}</span>`
                );
                found = true;
              }
            });

            if (filter === "" || found) {
              row.style.display = ""; // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙ
              hasVisibleRows = true;
            } else {
              row.style.display = "none"; // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙ
            }
          });

          // Ø¹Ø±Ø¶ Ø£Ùˆ Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬"
          document.querySelector(".no-results-message").style.display =
            hasVisibleRows ? "none" : "block";
        });
    </script>

    <script>
      // Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¹Ù„Ù…Ø© Ø§Ù„ÙØµÙ„ Ù…Ù† Ø§Ù„Ù€ URL
      const urlParams = new URLSearchParams(window.location.search);
      const classParam = urlParams.get("class");

      // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨
      function loadStudentsData() {
        fetch("/students_table")
          .then((response) => response.json())
          .then((data) => {
            const students = data.students;
            const tableBody = document.querySelector("tbody");
            tableBody.innerHTML = ""; // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©

            students.forEach((student) => {
              let row = document.createElement("tr");
              row.innerHTML = `
                    <td>
                        <button onclick="redirectToEdit('${
                          student.student_number
                        }', '${student.name}', '${student.name_ar}', '${
                student.id_card
              }', '${student.code_massar}', '${student.points}')">ØªØ¹Ø¯ÙŠÙ„</button>
                    </td>
                    <td class="${
                      student.points === "absent"
                        ? "status-absent"
                        : student.points >= 10
                        ? "status-v"
                        : "status-nv"
                    }">
                        ${
                          student.points === "absent"
                            ? "ØºØ§Ø¦Ø¨"
                            : student.points >= 10
                            ? "Ù…Ø³ØªÙˆÙÙ"
                            : "Ù…Ø³ØªØ¯Ø±Ùƒ"
                        }
                    </td>
                    <td>${
                      student.points === "absent" ? "absent" : student.points
                    }</td>
                    <td>${student.name_ar}</td>
                    <td>${student.name}</td>
                    <td>${student.id_card}</td>
                    <td>${student.code_massar}</td>
                    <td>${student.student_number}</td>
                `;
              tableBody.appendChild(row);
            });
          })
          .catch((error) =>
            console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error)
          );
      }

      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
      window.onload = loadStudentsData;

      // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
      function showStudents(className) {
        fetch(`/students_data/${className}`)
          .then((response) => response.json())
          .then((students) => {
            displayStudents(students);
          })
          .catch((error) =>
            console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error)
          );
      }

      function displayStudents(students) {
        const tableBody = document.querySelector("tbody");
        tableBody.innerHTML = ""; // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©

        if (students.length === 0) {
          tableBody.innerHTML =
            '<tr><td colspan="7">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</td></tr>';
          return;
        }

        students.forEach((student) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td><button onclick="redirectToEdit('${student.student_number}', '${
            student.name
          }', '${student.name_ar}', '${student.id_card}', '${
            student.code_massar
          }', '${student.points}')">ØªØ¹Ø¯ÙŠÙ„</button></td>
            <td class="${
              student.points === "absent"
                ? "status-absent"
                : student.points >= 10
                ? "status-v"
                : "status-nv"
            }">
                ${
                  student.points === "absent"
                    ? "ØºØ§Ø¦Ø¨"
                    : student.points >= 10
                    ? "Ù…Ø³ØªÙˆÙÙ"
                    : "Ù…Ø³ØªØ¯Ø±Ùƒ"
                }
            </td>
            <td>${student.points === "absent" ? "absent" : student.points}</td>
            <td>${student.name_ar}</td>
            <td>${student.name}</td>
            <td>${student.id_card}</td>
            <td>${student.code_massar}</td>
            <td>${student.student_number}</td>
        `;
          tableBody.appendChild(row);
        });
      }
    </script>

    <style>
      .highlight {
        background-color: yellow;
        font-weight: bold;
      }
    </style>

    <script>
      window.onload = function () {
        console.log("ğŸ” Ø¨ÙŠØ§Ù†Ø§Øª URL:", {
          number: urlParams.get("number"),
          name: urlParams.get("name"),
          nameAr: urlParams.get("nameAr"),
          id_card: urlParams.get("id_card"),
          code_massar: urlParams.get("code_massar"),
          points: urlParams.get("points"),
        });

        document.getElementById("student_number").value = studentNumber || "";
        document.getElementById("student_name").value = studentName || "";
        document.getElementById("student_name_ar").value = studentNameAr || "";
        document.getElementById("id_card").value = studentCne || "";
        document.getElementById("code_massar").value = studentCodemassar || "";
        document.getElementById("points").value = studentPoints || "";

        if (studentNumber && studentName && studentPoints) {
          document.getElementById("submitBtn").innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·";
        } else {
          document.getElementById("submitBtn").innerText = "Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø·";
        }
      };

      document
        .getElementById("submitBtn")
        .addEventListener("click", function (event) {
          event.preventDefault();

          const studentNumber = document
            .getElementById("student_number")
            .value.trim();
          const points = document.getElementById("points").value.trim();

          if (!studentNumber || !points) {
            alert("âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ùˆ Ø§Ù„Ù†Ù‚Ø§Ø·");
            return;
          }

          const action =
            document.getElementById("submitBtn").innerText === "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·"
              ? "update"
              : "add";
          const requestBody = { student_number: studentNumber, points: points };
          const url = action === "update" ? "/update_student" : "/add_student";

          fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(requestBody),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                showMessage(
                  "ØªÙ… " +
                    (action === "update" ? "ØªØ­Ø¯ÙŠØ«" : "Ø¥Ø¶Ø§ÙØ©") +
                    " Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨Ù†Ø¬Ø§Ø­!",
                  "success"
                );
                loadStudentsData();
                resetFields();
                document.getElementById("submitBtn").innerText = "Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø·";
                document.getElementById("updateBtn").style.display = "none";
              }
            })
            .catch((error) =>
              console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error)
            );
        });

      function resetFields() {
        document.getElementById("student_name").value = "";
        document.getElementById("student_name_ar").value = "";
        document.getElementById("id_card").value = "";
        document.getElementById("code_massar").value = "";
        document.getElementById("points").value = "";
      }

      function showMessage(message, type = "error") {
        if (message.trim().toLowerCase() === "ok") return; // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ "ok"

        const notification = document.getElementById("notification");
        notification.innerHTML = `<span>${
          (type === "error" ? "âŒ " : "âœ… ") + message
        }</span>`;
        notification.className = `message-box show-message ${type}`;
        notification.style.display = "block";

        setTimeout(() => {
          notification.style.display = "none";
        }, 3000);
      }
    </script>
    <div id="notification" class="message-box" style="display: none"></div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        let pageGroup = document.body.getAttribute("data-page-group"); // ØªØ­Ø¯ÙŠØ¯ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØµÙØ­Ø©
        let savedLang = localStorage.getItem(`language_${pageGroup}`) || "ar"; // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø£Ùˆ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©

        // Ø¶Ø¨Ø· Ø§Ù„Ù„ØºØ© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        fetch(`/set_language/${savedLang}`, { method: "POST" }).then(() =>
          loadTranslations(savedLang)
        );

        function loadTranslations(lang) {
          fetch(`/get_translations/${lang}`)
            .then((response) => response.json())
            .then((data) => updateTranslations(data.translations));
        }

        window.changeLanguage = function (lang) {
          localStorage.setItem(`language_${pageGroup}`, lang); // Ø­ÙØ¸ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙÙ‚Ø·

          fetch(`/change_language/${lang}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                updateTranslations(data.translations);
              }
            });

          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ø¶Ù…Ø§Ù† Ø­ÙØ¸ Ø§Ù„Ù„ØºØ© Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹
          fetch(`/set_language/${lang}`, { method: "POST" });

          // ğŸ”¥ Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±Ø¬Ù…Ø©
          localStorage.setItem(
            "language_update",
            JSON.stringify({ group: pageGroup, lang: lang })
          );
        };

        function updateTranslations(translations) {
          document.querySelectorAll("[data-translate]").forEach((element) => {
            let key = element.getAttribute("data-translate");
            if (translations[key]) {
              if (
                element.tagName === "INPUT" ||
                element.tagName === "TEXTAREA"
              ) {
                element.setAttribute("placeholder", translations[key]);
              } else if (element.tagName === "OPTION") {
                element.textContent = translations[key];
              } else {
                element.textContent = translations[key];
              }
            }
          });
        }

        // ğŸ”¥ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ØºØ© Ù…Ù† Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙÙ‚Ø·
        window.addEventListener("storage", function (event) {
          if (event.key === "language_update") {
            let data = JSON.parse(event.newValue);
            if (data.group === pageGroup) {
              loadTranslations(data.lang);
            }
          }
        });
      });
    </script>
  </body>
</html>
