<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÙØ¶Ø§Ø¡ Ø§Ù„Ø·Ø§Ù„Ø¨</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: url("{{ url_for('static', filename='images/10.png') }}")
          no-repeat center center fixed;
        background-size: cover;
        margin: 0;
        padding: 20px;
        text-align: center;
      }

      .container {
        width: 90%;
        max-width: 1600px;
        margin: auto;
        background: rgba(255, 255, 255, 0.9);
        /* Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ Ø´ÙØ§ÙØ© Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© */
        padding: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        font-size: 20px;
        background: white;
        border-radius: 10px;
      }

      th,
      td {
        border: 1px solid #ddd;
        padding: 15px;
        text-align: center;
      }

      th {
        background-color: #007bff;
        color: white;
        font-size: 22px;
      }

      tr:nth-child(even) {
        background-color: rgba(240, 240, 240, 0.8);
      }

      @media (max-width: 768px) {
        .container {
          width: 100%;
          padding: 10px;
        }

        table {
          font-size: 16px;
        }

        th,
        td {
          padding: 10px;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1 style="color: #007bff">
        Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ {{ student_name or 'Ø§Ù„Ø·Ø§Ù„Ø¨' }} ğŸ‘‹
      </h1>
      <h2 data-translate="Welcome">ÙØ¶Ø§Ø¡ Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
      <table>
        <thead>
          <tr>
            <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
            <th>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
            <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
            <th>Ø§Ù„Ù…Ø¹Ø¯Ù„</th>
            <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
          </tr>
        </thead>
        <tbody>
          {% if students %} {% for student in students %}
          <tr>
            <td>{{ student.student_number }}</td>
            <td>{{ student.level }}</td>
            <td>{{ student.subject }}</td>
            <td>{{ student.average }}</td>
            <td>{{ student.notes | safe }}</td>
          </tr>
          {% endfor %} {% else %}
          <tr>
            <td colspan="5">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const dataForm = document.getElementById("dataForm");
        const idCardInput = document.getElementById("id_card");
        const majorInput = document.getElementById("major");
        const errorMessage = document.getElementById("error-message");
        const studentTable = document.getElementById("studentTable");
        const tableBody = document.getElementById("tableBody");

        dataForm.addEventListener("submit", async function (e) {
          e.preventDefault();

          const id_card = idCardInput.value.trim();
          const major = majorInput.value.trim();

          if (!id_card || !major) {
            errorMessage.textContent = "âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.";
            errorMessage.classList.remove("hidden");
            studentTable.classList.add("hidden");
            return;
          }

          try {
            const response = await fetch("/Student_space", {
              method: "POST",
              headers: {
                "Content-Type": "application/json", // Ù‡Ø°Ø§ Ù…Ù‡Ù… Ø¬Ø¯Ø§ Ø¬Ø¯Ø§
              },
              body: JSON.stringify({ id_card, major }), // Ù†Ø±Ø³Ù„ JSON
            });

            const data = await response.json(); // Ù†Ù‚Ø±Ø£Ù‡ ÙƒÙ€ JSON

            tableBody.innerHTML = "";

            if (data.success && data.students.length > 0) {
              errorMessage.classList.add("hidden");
              studentTable.classList.remove("hidden");

              data.students.forEach((student) => {
                const row = document.createElement("tr");
                row.innerHTML = `
            <td>${student.student_number}</td>
            <td>${student.level}</td>
            <td>${student.subject}</td>
            <td>${student.average}</td>
            <td>${student.notes}</td>
          `;
                tableBody.appendChild(row);
              });

              studentTable.style.opacity = 0;
              setTimeout(() => {
                studentTable.style.transition = "opacity 0.5s ease";
                studentTable.style.opacity = 1;
              }, 50);
            } else {
              studentTable.classList.add("hidden");
              errorMessage.textContent = "âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©.";
              errorMessage.classList.remove("hidden");
            }
          } catch (error) {
            console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„:", error);
            errorMessage.textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….";
            errorMessage.classList.remove("hidden");
            studentTable.classList.add("hidden");
          }
        });
      });
    </script>
  </body>
</html>
