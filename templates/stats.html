<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>ุฅุญุตุงุฆูุงุช ุงูุทุงูุจ</title>
    <link rel="stylesheet" href="static/css/style_chart.css" />
  </head>
  <body>
    <h1>๐ ุฅุญุตุงุฆูุงุช ุงูุทุงูุจ</h1>

    <div class="summary">
      <div class="card">
        <h2>{{ total_subjects }}</h2>
        <p>ุนุฏุฏ ุงูููุงุฏ</p>
      </div>

      <div class="card">
        <h2>{{ average_score }}</h2>
        <p>ุงููุนุฏู ุงูุนุงู</p>
      </div>
      <div class="card">
        <h2>{{ top_score }}</h2>
        <p>ุฃุนูู ููุทุฉ</p>
      </div>
      <div class="card">
        <h2>{{ lowest_score }}</h2>
        <p>ุฃูู ููุทุฉ</p>
      </div>
    </div>

    <h2 class="section-title">๐ ุชูุงุตูู ุงูููุงุท ุญุณุจ ุงููุงุฏุฉ</h2>
    <table>
      <tr>
        <th>ุงููุงุฏุฉ</th>
        <th>ุงูููุทุฉ</th>
        <th>ุงููุตู</th>
        <th>ุงูููุงุญุธุฉ</th>
      </tr>
      {% for item in data %}
      <tr>
        <td>{{ item.subject }}</td>
        <td>{{ item.points }}</td>
        <td>{{ item.semester }}</td>
        <td>{{ item.note }}</td>
      </tr>
      {% endfor %}
    </table>
    <!-- ููุชุจุฉ Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <h2 class="section-title">๐ ุชุทูุฑ ุงูููุงุท ู ุงูุฅุญุตุงุฆูุงุช ุงูุชูุงุนููุฉ</h2>

    <div class="charts-container">
      <div class="chart-card">
        <canvas id="barChart"></canvas>
        <p class="note" id="noteBarChart">
          ๐ ููุงุญุธุฉ: ูุฐุง ุงูุฑุณู ููุถุญ ุชูุฒูุน ุงูููุงุท ุญุณุจ ุงูููุงุฏ.
        </p>
        <p class="tip" id="tipBarChart">
          ๐ก ูุตูุญุฉ: ุฑูุฒ ุนูู ุงูููุงุฏ ุงูุชู ุญุตูุช ูููุง ุนูู ุฃูู ุงูููุงุท ูุชุญุณูู ูุณุชูุงู.
        </p>
      </div>

      <div class="chart-card">
        <canvas id="lineChart"></canvas>
        <p class="note" id="noteLineChart">
          ๐ ููุงุญุธุฉ: ูุฐุง ุงููุฎุทุท ููุธูุฑ ุชุทูุฑ ุงูููุงุท ุนุจุฑ ุงูููุงุฏ.
        </p>
        <p class="tip" id="tipLineChart">
          ๐ก ูุตูุญุฉ: ุชุชุจุน ุชูุฏูู ูุชุญุงูุธ ุนูู ูุณุชูุงู ุฃู ุชุญุณููู.
        </p>
      </div>

      <div class="chart-card">
        <canvas id="pieChart"></canvas>
        <p class="note" id="notePieChart">
          ๐ ููุงุญุธุฉ: ุงููุณุจุฉ ุงููุฆููุฉ ููู ูุงุฏุฉ ูู ูุฌููุน ุงูููุงุท.
        </p>
        <p class="tip" id="tipPieChart">
          ๐ก ูุตูุญุฉ: ุญุงูุธ ุนูู ุชูุงุฒู ุฃุฏุงุฆู ูู ุฌููุน ุงูููุงุฏ.
        </p>
      </div>

      <div class="chart-card">
        <canvas id="doughnutChart"></canvas>
        <p class="note" id="noteDoughnutChart">
          ๐ ููุงุญุธุฉ: ุชูุซูู ุฏุงุฆุฑู ูุดุงุจู ูููุฎุทุท ุงูุฏุงุฆุฑู ูุน ูุฑุงุบ ูุฑูุฒู.
        </p>
        <p class="tip" id="tipDoughnutChart">
          ๐ก ูุตูุญุฉ: ุฑููุฒ ุนูู ุงูููุงุฏ ุฐุงุช ุงูุชูุซูู ุงูุตุบูุฑ ูุชุญุณูููุง.
        </p>
      </div>

      <div class="chart-card">
        <canvas id="polarChart"></canvas>
        <p class="note" id="notePolarChart">
          ๐ ููุงุญุธุฉ: ูุฐุง ุงูุฑุณู ููุถุญ ูุฏู ููุฉ ุฃุฏุงุฆู ูู ุงูููุงุฏ.
        </p>
        <p class="tip" id="tipPolarChart">
          ๐ก ูุตูุญุฉ: ุญุงูู ุฑูุน ุงูููุงุท ูู ุงูููุงุฏ ุฐุงุช ุงูููู ุงูุตุบูุฑุฉ.
        </p>
      </div>

      <div class="chart-card">
        <canvas id="compareChart"></canvas>
        <p class="note" id="noteCompareChart">
          ๐ ููุงุญุธุฉ: ููุงุฑูุฉ ุงูููุงุท ุจูู ุงููุตู ุงูุฃูู ูุงูุซุงูู.
        </p>
        <p class="tip" id="tipCompareChart">
          ๐ก ูุตูุญุฉ: ุญุฏุฏ ุงููุตู ุงูุฃุถุนู ูุงุนูู ุนูู ุชุญุณููู.
        </p>
      </div>
      <button onclick="filterBySemester('ุงููุตู ุงูุฃูู')">ุงููุตู ุงูุฃูู</button>
      <button onclick="filterBySemester('ุงููุตู ุงูุซุงูู')">ุงููุตู ุงูุซุงูู</button>
      <button onclick="filterBySemester('ุงููุตู ุงูุซุงูุซ')">ุงููุตู ุงูุซุงูุซ</button>
      <button onclick="filterBySemester('ุงููุตู ุงูุฑุงุจุน')">ุงููุตู ุงูุฑุงุจุน</button>
      <button onclick="filterBySemester('ุงููุตู ุงูุฎุงูุณ')">ุงููุตู ุงูุฎุงูุณ</button>
      <button onclick="filterBySemester('ุงููุตู ุงูุณุงุฏุณ')">ุงููุตู ุงูุณุงุฏุณ</button>
    </div>

    <script>

      function filterBySemester(semester) {
          const filteredData = {{ data | tojson }};  // ุงูุจูุงูุงุช ุงูุฃุตููุฉ ูู ุจุงูุซูู
          const filteredLabels = [];
          const filteredPoints = [];

          filteredData.forEach(item => {
          if (item.semester === semester) {
              filteredLabels.push(item.subject);
              filteredPoints.push(item.points);
          }
          });

          // ุชุญุฏูุซ ุงูุฌุฏูู ูุงููุฎุทุทุงุช ุจูุงุกู ุนูู ุงููุตู
          updateTable(filteredData.filter(item => item.semester === semester));
          updateCharts(filteredLabels, filteredPoints);
      }

      // ุฏุงูุฉ ูุชุญุฏูุซ ุงูุฌุฏูู
      function updateTable(data) {
          const table = document.getElementById('studentTable');
          const rows = table.rows.length;
          for (let i = rows - 1; i > 0; i--) {
          table.deleteRow(i);
          }
          data.forEach(item => {
          const row = table.insertRow();
          row.insertCell(0).textContent = item.subject;
          row.insertCell(1).textContent = item.points;
          row.insertCell(2).textContent = item.semester;
          row.insertCell(3).textContent = item.note;
          });
      }

      // ุฏุงูุฉ ูุชุญุฏูุซ ุงููุฎุทุทุงุช
      function updateCharts(labels, points) {
          // ุชุญุฏูุซ ูุฎุทุท ุดุฑูุทู
          updateChart('barChart', labels, points, 'ุงูููุทุฉ ุญุณุจ ุงููุงุฏุฉ', 'bar');

          // ุชุญุฏูุซ ูุฎุทุท ุฎุทู
          updateChart('lineChart', labels, points, 'ุชุทูุฑ ุงูููุทุฉ', 'line');

          // ุชุญุฏูุซ ูุฎุทุท ุฏุงุฆุฑู
          updateChart('pieChart', labels, points, 'ูุณุจุฉ ุชูุฒูุน ุงูููุงุท ุญุณุจ ุงููุงุฏุฉ', 'pie');

          // ุชุญุฏูุซ ูุฎุทุท ุฏููุงุช
          updateChart('doughnutChart', labels, points, 'ูุฎุทุท ุงูุฏููุงุช ููููุงุท', 'doughnut');

          // ุชุญุฏูุซ ูุฎุทุท ูุทุจู
          updateChart('polarChart', labels, points, 'ูุฎุทุท ูุทุจู ูุชูุฏู', 'polarArea');

          // ููุงุฑูุฉ ุจูู ุงููุตููู ุงูุฃูู ูุงูุซุงูู
      }

      // ุฏุงูุฉ ูุชุญุฏูุซ ุงููุฎุทุท ุงูุนุงู
      function updateChart(chartId, labels, points, labelText, chartType) {
          const chartElement = document.getElementById(chartId);
          const existingChart = Chart.getChart(chartElement);
          if (existingChart) {
          existingChart.destroy();
          }

          new Chart(chartElement, {
          type: chartType,
          data: {
              labels: labels,
              datasets: [{
              label: labelText,
              data: points,
              backgroundColor: chartType === 'pie' || chartType === 'doughnut'
                  ? labels.map(() => '#' + Math.floor(Math.random() * 16777215).toString(16))
                  : '#3498db'
              }]
          },
          options: {
              responsive: true,
              plugins: {
              title: {
                  display: true,
                  text: labelText
              }
              }
          }
          });
      }

      // ุฏุงูุฉ ูุชุญุฏูุซ ูุฎุทุท ููุงุฑูุฉ ุงูููุงุท ุจูู ุงููุตููู
      function updateCompareChart(labels, semester1Points, semester2Points) {
          const compareChart = document.getElementById('compareChart');
          const existingChart = Chart.getChart(compareChart);
          if (existingChart) {
          existingChart.destroy();
          }

          new Chart(compareChart, {
          type: 'bar',
          data: {
              labels: labels,
              datasets: [
              {
                  label: 'ุงููุตู ุงูุฃูู',
                  data: semester1Points,
                  backgroundColor: 'rgba(52, 152, 219, 0.7)'
              },
              {
                  label: 'ุงููุตู ุงูุซุงูู',
                  data: semester2Points,
                  backgroundColor: 'rgba(231, 76, 60, 0.7)'
              }
              ]
          },
          options: {
              responsive: true,
              plugins: {
              title: {
                  display: true,
                  text: '๐ ููุงุฑูุฉ ุงูููุงุท ุจูู ุงููุตููู'
              }
              }
          }
          });
      }
    </script>

    <script>
      // ุงูุจูุงูุงุช ูู ุจุงูุซูู
      const labels = {{ data|map(attribute='subject')|list|tojson }};
      const pointsData = {{ data|map(attribute='points')|list|tojson }};

      const filteredLabels = [];
      const filteredPoints = [];

      // ุชุตููุฉ ุงูุจูุงูุงุช ููุชุฃูุฏ ูู ุฃู ุงูููุงุท ููุณุช NaN
      for (let i = 0; i < pointsData.length; i++) {
        const val = parseFloat(pointsData[i]);
        if (!isNaN(val)) {
          filteredLabels.push(labels[i]);
          filteredPoints.push(val);
        }
      }

      // ุฑุณู ูุฎุทุท ุดุฑูุทู
      new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
          labels: filteredLabels,
          datasets: [{
            label: 'ุงูููุทุฉ ุญุณุจ ุงููุงุฏุฉ',
            data: filteredPoints,
            backgroundColor: '#3498db',
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'ูุฎุทุท ุดุฑูุทู ููููุงุท'
            }
          }
        }
      });

      // ุฑุณู ูุฎุทุท ุฎุทู
      new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
          labels: filteredLabels,
          datasets: [{
            label: 'ุชุทูุฑ ุงูููุทุฉ',
            data: filteredPoints,
            borderColor: '#2ecc71',
            fill: false,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'ููุญูู ุชุทูุฑ ุงูููุงุท'
            }
          }
        }
      });

      // ุฑุณู ูุฎุทุท ุฏุงุฆุฑู
      new Chart(document.getElementById('pieChart'), {
        type: 'pie',
        data: {
          labels: filteredLabels,
          datasets: [{
            label: 'ูุณุจ ุงูููุงุท',
            data: filteredPoints,
            backgroundColor: filteredLabels.map(() => '#' + Math.floor(Math.random()*16777215).toString(16))
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'ูุณุจุฉ ุชูุฒูุน ุงูููุงุท ุญุณุจ ุงููุงุฏุฉ'
            }
          }
        }
      });

      // ุฃููุงู ุนุดูุงุฆูุฉ ูุญุณูุฉ
      const generateColors = (count) => {
        return Array.from({ length: count }, () =>
          `hsl(${Math.floor(Math.random() * 360)}, 70%, 60%)`
        );
      };

      const colors = generateColors(filteredLabels.length);

      // ุฑุณู ูุฎุทุท ุงูุฏููุงุช
      new Chart(document.getElementById('doughnutChart'), {
        type: 'doughnut',
        data: {
          labels: filteredLabels,
          datasets: [{
            label: 'ููุงุท',
            data: filteredPoints,
            backgroundColor: colors
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'ูุฎุทุท ุงูุฏููุงุช ููููุงุท'
            },
            tooltip: {
              callbacks: {
                label: ctx => `ุงููุงุฏุฉ: ${ctx.label} - ${ctx.parsed}`
              }
            }
          },
          animation: {
            animateScale: true
          }
        }
      });

      // ุฑุณู ูุฎุทุท ูุทุจู
      new Chart(document.getElementById('polarChart'), {
        type: 'polarArea',
        data: {
          labels: filteredLabels,
          datasets: [{
            label: 'ููุงุท',
            data: filteredPoints,
            backgroundColor: colors
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'ูุฎุทุท ูุทุจู ูุชูุฏู'
            }
          },
          animation: {
            animateRotate: true,
            animateScale: true
          }
        }
      });

      // ุจูุงูุงุช ุงููุตู ุงูุฃูู ูุงูุซุงูู ููููุงุฑูุฉ
      const semester1Points = {{ data|selectattr("semester", "equalto", "ุงููุตู ุงูุฃูู")|map(attribute="points")|list|tojson }};
      const semester2Points = {{ data|selectattr("semester", "equalto", "ุงููุตู ุงูุซุงูู")|map(attribute="points")|list|tojson }};
      const semesterLabels = {{ data|selectattr("semester", "equalto", "ุงููุตู ุงูุฃูู")|map(attribute="subject")|list|tojson }};

      // ุฑุณู ูุฎุทุท ููุงุฑูุฉ ุงูููุงุท ุจูู ุงููุตููู
      new Chart(document.getElementById('compareChart'), {
        type: 'bar',
        data: {
          labels: semesterLabels,
          datasets: [
            {
              label: 'ุงููุตู ุงูุฃูู',
              data: semester1Points,
              backgroundColor: 'rgba(52, 152, 219, 0.7)'
            },
            {
              label: 'ุงููุตู ุงูุซุงูู',
              data: semester2Points,
              backgroundColor: 'rgba(231, 76, 60, 0.7)'
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: '๐ ููุงุฑูุฉ ุงูููุงุท ุจูู ุงููุตููู'
            }
          }
        }
      });
    </script>
  </body>
</html>
