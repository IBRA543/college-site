<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</title>
    <link rel="stylesheet" href="static/css/style_chart.css" />
  </head>
  <body>
    <h1>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h1>

    <div class="summary">
      <div class="card">
        <h2>{{ total_subjects }}</h2>
        <p>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¯</p>
      </div>

      <div class="card">
        <h2>{{ average_score }}</h2>
        <p>Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…</p>
      </div>
      <div class="card">
        <h2>{{ top_score }}</h2>
        <p>Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø©</p>
      </div>
      <div class="card">
        <h2>{{ lowest_score }}</h2>
        <p>Ø£Ù‚Ù„ Ù†Ù‚Ø·Ø©</p>
      </div>
    </div>

    <h2 class="section-title">ğŸ“˜ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø©</h2>
    <table>
      <tr>
        <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
        <th>Ø§Ù„Ù†Ù‚Ø·Ø©</th>
        <th>Ø§Ù„ÙØµÙ„</th>
        <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</th>
      </tr>
      {% for item in data %}
      <tr>
        <td>{{ item.subject }}</td>
        <td>{{ item.points }}</td>
        <td>{{ item.semester }}</td>
        <td>{{ item.note }}</td>
      </tr>
      {% endfor %}
    </table>
    <!-- Ù…ÙƒØªØ¨Ø© Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <h2 class="section-title">ğŸ“ˆ ØªØ·ÙˆØ± Ø§Ù„Ù†Ù‚Ø§Ø· Ùˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</h2>

    <div class="charts-container">
      <div class="chart-card">
        <canvas id="barChart"></canvas>
        <p class="note" id="noteBarChart">
          ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ø§Ù„Ø±Ø³Ù… ÙŠÙˆØ¶Ø­ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¯.
        </p>
        <p class="tip" id="tipBarChart">
          ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªÙŠ Ø­ØµÙ„Øª ÙÙŠÙ‡Ø§ Ø¹Ù„Ù‰ Ø£Ù‚Ù„ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ØªØ­Ø³ÙŠÙ† Ù…Ø³ØªÙˆØ§Ùƒ.
        </p>
      </div>

      <div class="chart-card">
        <canvas id="lineChart"></canvas>
        <p class="note" id="noteLineChart">
          ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ø§Ù„Ù…Ø®Ø·Ø· ÙŠÙØ¸Ù‡Ø± ØªØ·ÙˆØ± Ø§Ù„Ù†Ù‚Ø§Ø· Ø¹Ø¨Ø± Ø§Ù„Ù…ÙˆØ§Ø¯.
        </p>
        <p class="tip" id="tipLineChart">
          ğŸ’¡ Ù†ØµÙŠØ­Ø©: ØªØªØ¨Ø¹ ØªÙ‚Ø¯Ù…Ùƒ Ù„ØªØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆØ§Ùƒ Ø£Ùˆ ØªØ­Ø³Ù‘Ù†Ù‡.
        </p>
      </div>

      <div class="chart-card">
        <canvas id="pieChart"></canvas>
        <p class="note" id="notePieChart">
          ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„ÙƒÙ„ Ù…Ø§Ø¯Ø© Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·.
        </p>
        <p class="tip" id="tipPieChart">
          ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ ØªÙˆØ§Ø²Ù† Ø£Ø¯Ø§Ø¦Ùƒ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯.
        </p>
      </div>

      <div class="chart-card">
        <canvas id="doughnutChart"></canvas>
        <p class="note" id="noteDoughnutChart">
          ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø©: ØªÙ…Ø«ÙŠÙ„ Ø¯Ø§Ø¦Ø±ÙŠ Ù…Ø´Ø§Ø¨Ù‡ Ù„Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ Ù…Ø¹ ÙØ±Ø§Øº Ù…Ø±ÙƒØ²ÙŠ.
        </p>
        <p class="tip" id="tipDoughnutChart">
          ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø°Ø§Øª Ø§Ù„ØªÙ…Ø«ÙŠÙ„ Ø§Ù„ØµØºÙŠØ± Ù„ØªØ­Ø³ÙŠÙ†Ù‡Ø§.
        </p>
      </div>

      <div class="chart-card">
        <canvas id="polarChart"></canvas>
        <p class="note" id="notePolarChart">
          ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ø§Ù„Ø±Ø³Ù… ÙŠÙˆØ¶Ø­ Ù…Ø¯Ù‰ Ù‚ÙˆØ© Ø£Ø¯Ø§Ø¦Ùƒ ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯.
        </p>
        <p class="tip" id="tipPolarChart">
          ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø­Ø§ÙˆÙ„ Ø±ÙØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø°Ø§Øª Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ØµØºÙŠØ±Ø©.
        </p>
      </div>

      <div class="chart-card">
        <canvas id="compareChart"></canvas>
        <p class="note" id="noteCompareChart">
          ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø©: Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨ÙŠÙ† Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø«Ø§Ù†ÙŠ.
        </p>
        <p class="tip" id="tipCompareChart">
          ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø­Ø¯Ø¯ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£Ø¶Ø¹Ù ÙˆØ§Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ­Ø³ÙŠÙ†Ù‡.
        </p>
      </div>
      <button onclick="filterBySemester('Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„')">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„</button>
      <button onclick="filterBySemester('Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ')">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ</button>
      <button onclick="filterBySemester('Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù„Ø«')">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù„Ø«</button>
      <button onclick="filterBySemester('Ø§Ù„ÙØµÙ„ Ø§Ù„Ø±Ø§Ø¨Ø¹')">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø±Ø§Ø¨Ø¹</button>
      <button onclick="filterBySemester('Ø§Ù„ÙØµÙ„ Ø§Ù„Ø®Ø§Ù…Ø³')">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø®Ø§Ù…Ø³</button>
      <button onclick="filterBySemester('Ø§Ù„ÙØµÙ„ Ø§Ù„Ø³Ø§Ø¯Ø³')">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø³Ø§Ø¯Ø³</button>
    </div>

    <script>

      function filterBySemester(semester) {
          const filteredData = {{ data | tojson }};  // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ù† Ø¨Ø§ÙŠØ«ÙˆÙ†
          const filteredLabels = [];
          const filteredPoints = [];

          filteredData.forEach(item => {
          if (item.semester === semester) {
              filteredLabels.push(item.subject);
              filteredPoints.push(item.points);
          }
          });

          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙØµÙ„
          updateTable(filteredData.filter(item => item.semester === semester));
          updateCharts(filteredLabels, filteredPoints);
      }

      // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
      function updateTable(data) {
          const table = document.getElementById('studentTable');
          const rows = table.rows.length;
          for (let i = rows - 1; i > 0; i--) {
          table.deleteRow(i);
          }
          data.forEach(item => {
          const row = table.insertRow();
          row.insertCell(0).textContent = item.subject;
          row.insertCell(1).textContent = item.points;
          row.insertCell(2).textContent = item.semester;
          row.insertCell(3).textContent = item.note;
          });
      }

      // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª
      function updateCharts(labels, points) {
          // ØªØ­Ø¯ÙŠØ« Ù…Ø®Ø·Ø· Ø´Ø±ÙŠØ·ÙŠ
          updateChart('barChart', labels, points, 'Ø§Ù„Ù†Ù‚Ø·Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø©', 'bar');

          // ØªØ­Ø¯ÙŠØ« Ù…Ø®Ø·Ø· Ø®Ø·ÙŠ
          updateChart('lineChart', labels, points, 'ØªØ·ÙˆØ± Ø§Ù„Ù†Ù‚Ø·Ø©', 'line');

          // ØªØ­Ø¯ÙŠØ« Ù…Ø®Ø·Ø· Ø¯Ø§Ø¦Ø±ÙŠ
          updateChart('pieChart', labels, points, 'Ù†Ø³Ø¨Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø©', 'pie');

          // ØªØ­Ø¯ÙŠØ« Ù…Ø®Ø·Ø· Ø¯ÙˆÙ†Ø§Øª
          updateChart('doughnutChart', labels, points, 'Ù…Ø®Ø·Ø· Ø§Ù„Ø¯ÙˆÙ†Ø§Øª Ù„Ù„Ù†Ù‚Ø§Ø·', 'doughnut');

          // ØªØ­Ø¯ÙŠØ« Ù…Ø®Ø·Ø· Ù‚Ø·Ø¨ÙŠ
          updateChart('polarChart', labels, points, 'Ù…Ø®Ø·Ø· Ù‚Ø·Ø¨ÙŠ Ù…ØªÙ‚Ø¯Ù…', 'polarArea');

          // Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙŠÙ† Ø§Ù„ÙØµÙ„ÙŠÙ† Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø«Ø§Ù†ÙŠ
      }

      // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¹Ø§Ù…
      function updateChart(chartId, labels, points, labelText, chartType) {
          const chartElement = document.getElementById(chartId);
          const existingChart = Chart.getChart(chartElement);
          if (existingChart) {
          existingChart.destroy();
          }

          new Chart(chartElement, {
          type: chartType,
          data: {
              labels: labels,
              datasets: [{
              label: labelText,
              data: points,
              backgroundColor: chartType === 'pie' || chartType === 'doughnut'
                  ? labels.map(() => '#' + Math.floor(Math.random() * 16777215).toString(16))
                  : '#3498db'
              }]
          },
          options: {
              responsive: true,
              plugins: {
              title: {
                  display: true,
                  text: labelText
              }
              }
          }
          });
      }

      // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ù…Ø®Ø·Ø· Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨ÙŠÙ† Ø§Ù„ÙØµÙ„ÙŠÙ†
      function updateCompareChart(labels, semester1Points, semester2Points) {
          const compareChart = document.getElementById('compareChart');
          const existingChart = Chart.getChart(compareChart);
          if (existingChart) {
          existingChart.destroy();
          }

          new Chart(compareChart, {
          type: 'bar',
          data: {
              labels: labels,
              datasets: [
              {
                  label: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„',
                  data: semester1Points,
                  backgroundColor: 'rgba(52, 152, 219, 0.7)'
              },
              {
                  label: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ',
                  data: semester2Points,
                  backgroundColor: 'rgba(231, 76, 60, 0.7)'
              }
              ]
          },
          options: {
              responsive: true,
              plugins: {
              title: {
                  display: true,
                  text: 'ğŸ“š Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨ÙŠÙ† Ø§Ù„ÙØµÙ„ÙŠÙ†'
              }
              }
          }
          });
      }
    </script>

    <script>
      // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¨Ø§ÙŠØ«ÙˆÙ†
      const labels = {{ data|map(attribute='subject')|list|tojson }};
      const pointsData = {{ data|map(attribute='points')|list|tojson }};

      const filteredLabels = [];
      const filteredPoints = [];

      // ØªØµÙÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙŠØ³Øª NaN
      for (let i = 0; i < pointsData.length; i++) {
        const val = parseFloat(pointsData[i]);
        if (!isNaN(val)) {
          filteredLabels.push(labels[i]);
          filteredPoints.push(val);
        }
      }

      // Ø±Ø³Ù… Ù…Ø®Ø·Ø· Ø´Ø±ÙŠØ·ÙŠ
      new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
          labels: filteredLabels,
          datasets: [{
            label: 'Ø§Ù„Ù†Ù‚Ø·Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø©',
            data: filteredPoints,
            backgroundColor: '#3498db',
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Ù…Ø®Ø·Ø· Ø´Ø±ÙŠØ·ÙŠ Ù„Ù„Ù†Ù‚Ø§Ø·'
            }
          }
        }
      });

      // Ø±Ø³Ù… Ù…Ø®Ø·Ø· Ø®Ø·ÙŠ
      new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
          labels: filteredLabels,
          datasets: [{
            label: 'ØªØ·ÙˆØ± Ø§Ù„Ù†Ù‚Ø·Ø©',
            data: filteredPoints,
            borderColor: '#2ecc71',
            fill: false,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Ù…Ù†Ø­Ù†Ù‰ ØªØ·ÙˆØ± Ø§Ù„Ù†Ù‚Ø§Ø·'
            }
          }
        }
      });

      // Ø±Ø³Ù… Ù…Ø®Ø·Ø· Ø¯Ø§Ø¦Ø±ÙŠ
      new Chart(document.getElementById('pieChart'), {
        type: 'pie',
        data: {
          labels: filteredLabels,
          datasets: [{
            label: 'Ù†Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·',
            data: filteredPoints,
            backgroundColor: filteredLabels.map(() => '#' + Math.floor(Math.random()*16777215).toString(16))
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Ù†Ø³Ø¨Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø©'
            }
          }
        }
      });

      // Ø£Ù„ÙˆØ§Ù† Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ø­Ø³Ù†Ø©
      const generateColors = (count) => {
        return Array.from({ length: count }, () =>
          `hsl(${Math.floor(Math.random() * 360)}, 70%, 60%)`
        );
      };

      const colors = generateColors(filteredLabels.length);

      // Ø±Ø³Ù… Ù…Ø®Ø·Ø· Ø§Ù„Ø¯ÙˆÙ†Ø§Øª
      new Chart(document.getElementById('doughnutChart'), {
        type: 'doughnut',
        data: {
          labels: filteredLabels,
          datasets: [{
            label: 'Ù†Ù‚Ø§Ø·',
            data: filteredPoints,
            backgroundColor: colors
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Ù…Ø®Ø·Ø· Ø§Ù„Ø¯ÙˆÙ†Ø§Øª Ù„Ù„Ù†Ù‚Ø§Ø·'
            },
            tooltip: {
              callbacks: {
                label: ctx => `Ø§Ù„Ù…Ø§Ø¯Ø©: ${ctx.label} - ${ctx.parsed}`
              }
            }
          },
          animation: {
            animateScale: true
          }
        }
      });

      // Ø±Ø³Ù… Ù…Ø®Ø·Ø· Ù‚Ø·Ø¨ÙŠ
      new Chart(document.getElementById('polarChart'), {
        type: 'polarArea',
        data: {
          labels: filteredLabels,
          datasets: [{
            label: 'Ù†Ù‚Ø§Ø·',
            data: filteredPoints,
            backgroundColor: colors
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Ù…Ø®Ø·Ø· Ù‚Ø·Ø¨ÙŠ Ù…ØªÙ‚Ø¯Ù…'
            }
          },
          animation: {
            animateRotate: true,
            animateScale: true
          }
        }
      });

      // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø«Ø§Ù†ÙŠ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
      const semester1Points = {{ data|selectattr("semester", "equalto", "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„")|map(attribute="points")|list|tojson }};
      const semester2Points = {{ data|selectattr("semester", "equalto", "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ")|map(attribute="points")|list|tojson }};
      const semesterLabels = {{ data|selectattr("semester", "equalto", "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„")|map(attribute="subject")|list|tojson }};

      // Ø±Ø³Ù… Ù…Ø®Ø·Ø· Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨ÙŠÙ† Ø§Ù„ÙØµÙ„ÙŠÙ†
      new Chart(document.getElementById('compareChart'), {
        type: 'bar',
        data: {
          labels: semesterLabels,
          datasets: [
            {
              label: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„',
              data: semester1Points,
              backgroundColor: 'rgba(52, 152, 219, 0.7)'
            },
            {
              label: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ',
              data: semester2Points,
              backgroundColor: 'rgba(231, 76, 60, 0.7)'
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'ğŸ“š Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨ÙŠÙ† Ø§Ù„ÙØµÙ„ÙŠÙ†'
            }
          }
        }
      });
    </script>
  </body>
</html>
